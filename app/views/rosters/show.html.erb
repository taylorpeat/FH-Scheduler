<h3><%= @roster.name %></h3>
<hr>
<%= link_to "Update roster", edit_roster_path, class: "btn btn-primary"%>
<%= link_to "Previous Day", roster_path(@roster, day_change: @day_change - 1, week_change: @week_change, drop: @player_to_drop), class: "btn btn-default" %>
<%= link_to "Next Day", roster_path(@roster, day_change: @day_change + 1, week_change: @week_change, drop: @player_to_drop), class: "btn btn-default" %>
<%= link_to "Last Week", roster_path(@roster, week_change: @week_change - 1, day_change: 0, drop: @player_to_drop), class: "btn btn-warning" %>
<%= link_to "Next Week", roster_path(@roster, week_change: @week_change + 1, day_change: 0, drop: @player_to_drop), class: "btn btn-warning" %>
<br>
<br>
<table class="table table-bordered table-hover make_fixed">
  <thead>
  <tr>
    <th>Pos</th>
    <th>Forwards/Defenseman<span style="color:#FFFFFF">____________</span></th>
    <% for i in 0..13 %>
      <% if changed_date == (changed_week + i.day) %>
        <th bgcolor="#e5e5ff">
      <% else %>
        <th>
      <% end %>
        <%= link_to table_time(changed_week + i.day), roster_path(@roster, day_change: initial_time_offset + i, week_change: @week_change) %>
      </th>
      <% if [6,13].include?(i) %>
        <th bgcolor="#DCDCDC"><%= "Games" %></th>
        <th bgcolor="#DCDCDC"><%= "Conflicts" %></th>
      <% end %>
    <% end %>
  </tr>
  </thead>
  <% @roster.hash(changed_date).select { |pos, players| ![5, :conflicts].include?(pos) }.each do |pos, players| %>
    <% players.select { |player_id| find_player(player_id).nil? || !find_player(player_id).position_ids.include?(5) }.each do |player_id| %>
      <%= render 'player_table', player_id: player_id, pos: pos %>
    <% end %>
  <% end %>
</table>
<br>

<table class="table table-bordered table-hover">
  <tr>
    <th>Pos</th>
    <th>Goaltenders<span style="color:#FFFFFF">______________________</span></th>
    <% for i in 0..13 %>
    <% if changed_date == (changed_week + i.day) %>
      <th bgcolor="#e5e5ff">
    <% else %>
      <th>
    <% end %>
        <%= link_to table_time(changed_week + i.day), roster_path(@roster, day_change: initial_time_offset + i, week_change: @week_change) %>
      </th>
      <% if [6,13].include?(i) %>
        <th bgcolor="#DCDCDC"><%= "Games" %></th>
        <th bgcolor="#DCDCDC"><%= "Conflicts" %></th>
      <% end %>
    <% end %>
  </tr>
  <% @roster.hash(changed_date).select { |pos, players| pos == 5 }.each do |pos, players| %>
    <% players.each do |player_id| %>
      <%= render 'player_table', player_id: player_id, pos: pos %>
    <% end %>
  <% end %>
  <% @roster.hash(changed_date).select { |pos, players| [8,9].include?(pos) }.each do |pos, players| %>
    <% players.select { |player_id| !find_player(player_id).nil? && find_player(player_id).position_ids.include?(5) }.each do |player_id| %>
      <%= render 'player_table', player_id: player_id, pos: pos %>
    <% end %>
  <% end %>
</table>
<br>
<div class = "form-group">
  <%= form_tag roster_path(@roster, week_change: @week_change, day_change: @day_change), method: 'get', enforce_utf8: false do %>
    <%= label_tag 'Select Player to Drop' %>
    <br>
    <%= select_tag "drop", options_from_collection_for_select(@roster.players, "id", "name") %>
    <%= submit_tag nil, class: "Generate Report" %>
  <% end %>
</div>

<% if @player_to_drop %>
  <% dropped_player = @players.find(@player_to_drop) %>
  <% set_open_games_per_position(dropped_player.id) %>
  <hr>
  <p><%= "Dropping: #{dropped_player.name}" %></p>
  <br>
  <p><strong><%= "Recommended Adds:" %></strong></p>
  <table>
    <col width="300">
    <col width="300">
    <col width="300">
    <thead>  
      <tr>
        <% unless five_game_players.empty? %>
          <th><%= "Players with 5+ games:"%></th>
        <% end %>
        <% unless four_game_players.empty? %>
        <th><%= "Players with 4 compatible games:" %></th>
        <% end %>
        <% unless three_game_players.empty? %>
        <th><%= "Players with 3 compatible games:" %></th>
        <% end %>
        <% unless !five_game_players.empty? || two_game_players.empty? %>
        <th><%= "Players with 2 compatible games:" %></th>
        <% end %>
        <% unless !four_game_players.empty? || one_game_players.empty? %>
        <th><%= "Players with 1 compatible game:" %></th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% for row_num in 0..49 %>
        <tr>
        <% [five_game_players, four_game_players, three_game_players, two_game_players, one_game_players].reject {|players| players.empty? }.slice(0..2).each do |players| %>
          <% player = players[row_num] %>
          <% if player %>
            <td>
             <%= "#{player.id}: #{player.name} - #{player.positions.select { |pos| (1..5).include?(pos.id) }.map {|pos| pos.name }.join(",")}" %>
            </td>
          <% else %>
            <td></td>
          <% end %>
        <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
<hr>