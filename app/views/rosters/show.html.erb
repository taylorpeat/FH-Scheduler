<h3><%= @roster.name %></h3>
<hr>
<%= link_to "Update roster", edit_roster_path, class: "btn btn-primary"%>
<%= link_to "Previous Day", roster_path(@roster, day_change: @day_change - 1, week_change: @week_change), class: "btn btn-default" %>
<%= link_to "Next Day", roster_path(@roster, day_change: @day_change + 1, week_change: @week_change), class: "btn btn-default" %>
<%= link_to "Last Week", roster_path(@roster, week_change: @week_change - 1, day_change: 0), class: "btn btn-warning" %>
<%= link_to "Next Week", roster_path(@roster, week_change: @week_change + 1, day_change: 0), class: "btn btn-warning" %>
<br>
<br>
<table class="table table-bordered table-hover make_fixed">
  <thead>
  <tr>
    <th>Pos</th>
    <th>Forwards/Defenseman<span style="color:#FFFFFF">____________</span></th>
    <% for i in 0..13 %>
      <% if changed_date == (changed_week + i.day) %>
        <th bgcolor="#e5e5ff">
      <% else %>
        <th>
      <% end %>
        <%= link_to table_time(changed_week + i.day), roster_path(@roster, day_change: initial_time_offset + i, week_change: @week_change) %>
      </th>
      <% if [6,13].include?(i) %>
        <th bgcolor="#DCDCDC"><%= "Games" %></th>
        <th bgcolor="#DCDCDC"><%= "Conflicts" %></th>
      <% end %>
    <% end %>
  </tr>
  </thead>
  <% @roster.hash(changed_date).select { |pos, players| ![5, :conflicts].include?(pos) }.each do |pos, players| %>
    <% players.select { |player_id| find_player(player_id).nil? || !find_player(player_id).position_ids.include?(5) }.each do |player_id| %>
      <%= render 'player_table', player_id: player_id, pos: pos %>
    <% end %>
  <% end %>
</table>
<br>

<table class="table table-bordered table-hover">
  <tr>
    <th>Pos</th>
    <th>Goaltenders<span style="color:#FFFFFF">______________________</span></th>
    <% for i in 0..13 %>
    <% if changed_date == (changed_week + i.day) %>
      <th bgcolor="#e5e5ff">
    <% else %>
      <th>
    <% end %>
        <%= link_to table_time(changed_week + i.day), roster_path(@roster, day_change: initial_time_offset + i, week_change: @week_change) %>
      </th>
      <% if [6,13].include?(i) %>
        <th bgcolor="#DCDCDC"><%= "Games" %></th>
        <th bgcolor="#DCDCDC"><%= "Conflicts" %></th>
      <% end %>
    <% end %>
  </tr>
  <% @roster.hash(changed_date).select { |pos, players| pos == 5 }.each do |pos, players| %>
    <% players.each do |player_id| %>
      <%= render 'player_table', player_id: player_id, pos: pos %>
    <% end %>
  <% end %>
  <% @roster.hash(changed_date).select { |pos, players| [8,9].include?(pos) }.each do |pos, players| %>
    <% players.select { |player_id| !find_player(player_id).nil? && find_player(player_id).position_ids.include?(5) }.each do |player_id| %>
      <%= render 'player_table', player_id: player_id, pos: pos %>
    <% end %>
  <% end %>
</table>
<br>
<% if @players_to_drop %>
  <% dropped_players = @players_to_drop.map { |player_id| Player.find(player_id) } %>
  <% dropped_players.each do |dropped_player| %>
    <% set_open_games_per_position(dropped_player.id) %>
    <%= "Dropping: #{dropped_player.name}" %>
    <hr>
    <br>
    <%= "Recommended Adds:" %>
    <br>
    <% unless five_game_players.empty? %>
      <br>
      <%= "Players with 5+ games:" %>
      <br>
      <% five_game_players.slice(0..49).each do |player| %>
        <%= " #{player.name} - #{player_open_games(player).size} games" %>
        <br>
      <% end %>
    <% end %>
    <% unless four_game_players.empty? %>
      <br>
      <%= "Players with 4 games:" %>
      <br>
      <% four_game_players.slice(0..49).each do |player| %>
        <%= " #{player.name} - #{player_open_games(player).size} games" %>
        <br>
      <% end %>
    <% end %>
    <% unless three_game_players.empty? %>
      <br>
      <%= "Players with 3 games:" %>
      <br>
      <% three_game_players.slice(0..49).each do |player| %>
        <%= " #{player.name} - #{player_open_games(player).size} games" %>
        <br>
      <% end %>
    <% end %>
    <% unless two_game_players.empty? || !four_game_players.empty? %>
      <br>
      <%= "Players with 2 games:" %>
      <br>
      <% two_game_players.slice(0..49).each do |player| %>
        <%= " #{player.name} - #{player_open_games(player).size} games" %>
        <br>
      <% end %>
    <% end %>
    <% unless one_game_players.slice(0..49).empty? || !three_game_players.empty? %>
      <br>
      <%= "Players with 1 game:" %>
      <br>
      <% one_game_players.each do |player| %>
        <%= " #{player.name} - #{player_open_games(player).size} games" %>
        <br>
      <% end %>
    <% end %>
  <% end %>
<% end %>